---
layout: post
title: 디스크 관리
date: 2019-09-17 21:29:00
author: "SeWonKim"
categories: [CS, OS]
tags: [OS]
comments: true
description: 디스크 관리
---

# 디스크 관리

## key point

### 하드 디스크의 구조

하드 디스크 = 대용량 기억 장치

- 플래터
- 트랙, 섹터, 실린더
- 디스크 포맷

### 파일 시스템

하드 디스크에 파일이나 디렉터리를 작성할 때 어떻게 기록할 지 정한 것

---

## 🖥️외부 기억 장치의 종류

프로그램이나 데이터를 저장하는 외부 기억 장치는 데이터의 액세스 방식별로 분류할 수 있다.

- 랜덤 액세스(Random Access)
- 시퀀셜 액세스(Sequential Access)

랜덤 액세스는 데이터의 위치에 직접 액세스 하는 방식으로 고속으로 데이터에 액세스 할 수 있다. (CD, DVD 등 등)  
시퀀셜 액세스는 데이터를 처음부터 순서대로 검색하여 액세스 하는 방법이다.(자기 테이프, 플래시 메모리, SD카드)

## 🖥️디스크 시스템

OS에 따라서 외부 기억 장치가 어떻게 할당 되는지, 어떻게 사용되는지가 다르다.

### Windows

하드디스크 드라이브 등을 'Drive'라는 단위로 할당한다. C:, D:, E:, ...  
하나의 디스크를 분할하여 드라이브를 할당 할 수도 있다. 분할한 각 영역을 파티션이라고 한다.

### Unix

접속된 외부 기억장치가 dev 디렉터리 아래의 폴더로 나타난다.

컴퓨터에 접속한 외부 기억 장치를 디렉터리 계층으로 이용할 수 있는 상태로 만드는 것을 마운트(Mount)라고한다.
반대로 해제하는 것은 언마운트라고 한다.

## 🖥️파일과 디렉터리

### 파일

OS는 데이터를 파일 단위로 관리한다.

**파일 종류**

- OS에서 실행 할 수 있는 파일
- 정보가 기록되어있을 뿐인 데이터 파일

확장자(Unix에서는 서픽스)로 파일 종류를 구분할 수 있다.

### 디렉터리(폴더)

OS에서는 파일을 계층 구조로 된 디렉터리에 저장해 관리한다. 최상위 디렉터리를 '루트 디렉터리', 그 아래 것을 '서브 디렉터리'라고 한다.

루트 디렉터리를 기준으로 특정 디렉터리까지의 경로를 나타낸 것을 절대경로  
특정 디렉터리를 기준으로 특정 디렉터리까지의 경로를 나타낸 것을 상대경로 라고 한다.

## 🖥️트랙과 섹터

하드디스크는 플레터(Platter)라는 원반이 여러장 조합된 구조로 이루어져 있다.

- 트랙(Track): 동심원 상태인 영역
- 섹터(Sector): 트랙을 분할 한 영역
- 실린더(Cylinder): 트랙의 모음

**하드디스크 기억 용량 = 섹터 사이즈 _ 1트랙당 섹터 수 _ 1실린더당 트랙 수 \* 실린더 수**  
**하드디스크 속도 = 1트랙 용량 \* 1초당 회전 수**

### 클러스터(Cluster)

OS가 파일을 취급할 때는 섹터 단위가 아니라 섹터를 몇 개 모은 클러스터 단위로 관리한다.

```
1클러스터 = 4섹터인 경우
(일반적인 자기 디스크 섹터의 크기는 512byte)

1800 byte 파일 = 512byte*3 + 264byte

1클러스터가 되지 않는 파일도 1클러스터 분으로 할당되기 때문에 미사용 영역이 생긴다.
이 때 디스크상의 파일 사이즈는 512*4=2048byte이다.
```

클러스터에 파일을 할당할 때 발생하는 미사용 영역이 프래그먼테이션의 원인이 된다.

## 🖥️디스크 포맷

기억 장치에 파일이나 디렉터리를 기록하는 방법을 파일 시스템 또는 디스크 포맷이라고 한다.

### OS에 따라 다른 파일 시스템(디스크 포맷)

| windows | Linux |  Mac OS  | CD-ROM  | 광디스크 |
| :-----: | :---: | :------: | :-----: | :------: |
|  FAT32  | ext3  | HFS Plus | ISO9660 |   UDF    |
|  NTFS   |       |          |         |          |

OS가 지원하지 않는 파일 시스템에는 액세스할 수 없다.

### 디스크의 초기화

하드 디스크를 사용하려면 파티션을 작성한 후 물리 포맷, 논리 포맷 처리를 순서대로 수행해야한다.  
물리 포맷은 섹터에 기록된 데이터를 모두 삭제하는 것이고, 논리 포맷은 파일 시스템이 관리하는 영역을 작성(섹터의 구획을 정리)한다.

## 🖥️파일 작성

### 스트림(Stream)

프로그램이 파일을 읽고 쓸 때, 프로세스와 파일 간에 데이터가 통하는 길을 만들어서 주고받는다.
이 통로를 흐르는 데이터를 스트림이라고 한다.

스트림 조작

- .Open(파일 열기) : 시스템콜을 받아서 커널이 파일과 프로세스를 연결
- .Read(읽기) : 스트림이 파일에서 프로세스로 이동
- .Write(쓰기) : 스트림이 프로세스에서 파일로 이동
- .Close(파일 닫기)

## 🖥️프래그먼테이션(Fragmentation)

기억 장치의 기억 영역에 단편적인 데이터가 저장되어 있는 상태를 말한다. (순서대로 기록 되어있는 게 아니라 분할 저장되어있는 것)  
하나의 파일이 여러 트랙에 분할되어 기록되어있기 때문에 시크(seek) 횟수가 증가하여 액세스하는데 시간이 걸린다.

### 디프레그(Defrag)

프래그먼테이션을 해소하기 위해 단편화 된 디스크의 기억 영역을 연속된 영역으로 다시 기록하는 것이다.
용량이 적은 파일 일수록 효과적이다. 디프레그를 통해 시크 횟수를 줄이고 OS부담을 줄일 수 있다.

**메모리의 단편화 해소는 컴팩션(조각모음)이고, 디스크의 단편화 해소는 디프레그 이다.**

### 디스크 액세스 시간

디스크 액세스 시간 = 평균 시크 시간 + 회전 대기시간(1회전에 소요되는 시간/2) + 데이터 전송 시간(섹터 사이즈/데이터 전송 속도)

| 회전 속도         | 2,000회전/분 (1회전에 30ms) |
| ----------------- | --------------------------- |
| 평균 시크 시간    | 10ms                        |
| 1트랙당 기억 용량 | 9,000byte                   |
| 섹터 사이즈       | 3,000byte                   |

회전 대기 시간 = 1회전에 소요되는 시간 / 2 = 30 / 2 = 15ms  
데이터 전송 속도 = 1트랙당 기억 용량 / 1회전에 소요되는 시간 = 9,000 / 30 = 300byte/ms  
데이터 전송 시간 = 섹터 사이즈 / 데이터 전송 속도 = 3,000 / 300 = 10ms

👉디스크 액세스 시간 = 10 + 15 + 10 = 35ms

## 🖥️사용자별 파일 관리

### 액세스 권한(Permission)

파일에는 읽기나 쓰기같은 액세스를 허가하는 정보가 정의되어 있다.
특정 사용자나 그룹으로 액세스 권한을 설정할 수도 있다.

### 쿼터(Quota)

사용자가 OS를 공유할 때 각 사용자가 사용할 수 있는 하드디스크 용량의 상한값을 쿼터라고 한다.
쿼터 이상으로 데이터를 쓰려고 하면 OS가 쓰기를 거부한다.

## 🖥️디스크 캐시

하드디스크의 처리능력은 CPU나 메모리에 비해 매우 느리다.
이런 결점을 보완하기 위해 하드디스크에서 읽어들인 데이터를 일시적으로 디스크 캐시(Disk Cache)에 저장한다.
동일한 데이터를 자주 읽어들일 때 디스크 캐시를 이용하면 효과적이다. 그때그때 자기 디스크로부터 읽어들일 필요가 없어지므로 액세스 속도가 향상된다.

### RAM 디스크

RAM을 디스크 드라이브로 사용할 수 있도록 한 것이다. 보통의 디스크에 비해 고속으로 액세스 할 수 있지만 휘발성이다.  
최근에는 캐시 메모리나 SSD로 성능을 충분히 올릴 수 있어서 RAM 디스크는 별로 사용하지 않는다.

## 🖥️압축

압축이란 데이터를 숫자적으로 변환하여 내용은 그대로 유지한 채 크기를 줄이는 것이다.
파일을 사용할 때에는 압축 풀기를 통해 데이터를 원래의 형식으로 복원한다.

- RLE(Run Length Encoding) 방식
- Huffman 방식

### 비가역 압축

파일 내용이 다소 손실되는 것을 비가역 압축이라고 한다.
주로 그림, 음성, 동영상 분야에서 활용되는데 사람이 느끼기 힘들 정도의 미세한 정보를 삭제한다.

### 가역 압축

파일 내용이 손실되지 않는 압축을 가역 압축이라고 한다.

## 🖥️검색

### 인덱스화

인덱스는 파일의 목차이다. 파일에 독자적인 번호를 붙여서 관리함으로써 검색할 때 모든 파일을 직접 조사할 필요가 없고, 검색 속도도 향상된다.

### 풀텍스트 검색(Fulltext Search)

여러 파일의 내용을 조사하여 특정 문자열을 검색하는 것이다.

- 순차 주사(走査) 검색: 파일 수가 많을수록 검색 속도가 느려진다.
- 인덱스 검색: 사전에 파일을 조사하여 인덱스화하고 그 안에서 검사한다. 파일 수가 많을 때 고속으로 검사 할 수 있다.

## 🖥️리던던시(Redundancy)

시스템의 리던던시 = 여유도  
데이어틔 리던던시 = 중복성

### 시스템의 리던던시

시스템의 리던던시는 시스템 장애가 발생해도 큰 손실이 없도록 시스템 전체에 여유를 가지게 하는 것을 말한다.
기기를 최소 필요한 것 이상을 마련해놓는 방식으로 여유를 가지게 한다.

리던던시 방법

- 듀얼 시스템
- 듀플렉스 시스템

듀얼 시스템은 동일한 처리를 여러 대에 동시에 작동시키는 구성이고, 듀플렉스 시스템은 다른 기기를 예비로 대비시키는 구성이다.

### 데이터의 리던던시

데이터 안에 실질적으로 의미가 없는 여분의 데이터가 있는 상태를 데이터의 리던던시라고 한다.
데이터의 정당성을 검증하기 위해 확인을 위한 값을 추가하는 것을 '리던던시를 지닌다'라고 한다.

통신 등에 의한 데이터 오류 체크 방법

- 패리티 검사(Parity Check): 데이터가 홀수인지 짝수인지 나타내는 비트를 추가하여 데이터 전송 후에도 그 패리티 비트가 같은지 검사하는 방법
- 체크섬(Checksum): 정해진 방법으로 값을 산출해서 데이터 전송 후에도 일치하는 지 검사하는 방법

### RAID(Redundant Array of Inexpensive Disk)

여러 개의 하드디스크를 연결하여 동시에 여러 개의 하드디스크에 액세스하는 방식이다.
RAID 방식을 사용하면 CPU나 메모리의 부담이 줄어들며, OS에도 부담이 적어진다.

RAID는 신뢰성 레벨에 따라서 RAID0~RAID5가 있고, RAID5가 신뢰성이 가장 뛰어나다.

---

## 용어 정리

1. 트랙(Track)
2. 섹터(Sector)
3. 파일 시스템
4. 단편화(Fragmentation)
5. 리던던시(Redundancy)
