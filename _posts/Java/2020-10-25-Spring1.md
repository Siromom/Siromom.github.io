---
layout: post
title: 🎩Spring framework - Ioc/DI
date: 2020-10-25 22:30:00
author: 'SeWonKim'
categories: [Java]
tags: [jekyll, TIL, Java, web, spring]
fullview: false
comments: true
description: Spring framework 개념
---

### Spring 이전에 사용하던 EJB

- Session Bean, Entity Bean 등의 요소들을 설정해야한다. 
- 기존에 작성된 `POJO`를 변경해야한다.
- 배우기도 어려워...😤
- 테스트를 위해 반드시 EJB 서버가 필요하여 테스트하기 어렵고, 개발의 효율성이 떨어져 *Spring 등장*!

### Spring Framework

- DI, AOP 와 같은 새로운 프로그래밍 방법론으로 가능
- POJO + Framework
- 개발자가 low level에 신경쓰지 않고, business logic 개발에 전념할 수 있도록 해준다.
- 나중에는 Spring이 다른 프레임워크에 비해 무거워져서 *Spring boot가 등장*! => xml 설정을 하지 않아도 개발을 시작할 수 있게 되었다.


`POJO(Plain Old Java Object)` : 특정 프레임워크나 기술에 의존적이지 않은 자바 객체

---

## IoC(Inversion of Control) 패턴

제어의 역행       
: 미리 객체를 만들어놓고, 필요한 때에 가져와서 쓴다.      
객체 간의 강한 결합을 Factory를 통해 느슨하게 만든다. (싱글톤 패턴 적용)


IoC의 구현 방법 중 하나가 DI(Dependecy Injection)       
- container에 bean을 등록하고 설정하는 방법은 xml을 사용하는 방법과 annotation을 활용하는 방법이 있다.
- applicationContext.xml 에 bean태그를 사용해서 인스턴스를 관리한다

---

## Spring 프로젝트 생성

### pom.xml 

- Spring library 설정은 pom.xml 에서!
- 버전 5.2.6 사용

MVNRepository에서 의존 관계 설정할 수 있다.     
라이브러리를 하나하나 buildpath에 import 시킬 필요없이 알아서 받아준다. 예시👇
```
<!-- https://mvnrepository.com/artifact/org.springframework/spring-context -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>5.2.6.RELEASE</version>
</dependency>
```

### applicationContext.xml

- 내가 관리해야 하는 객체 정보를 적어 놓는다.
- **ApplicationContext**(주입기 역할)에 여기 저장되어 있는 값들을 담고
- getBean() 메소드를 통해서 저장 된 객체를 가져와 사용한다. 
- Annnotation을 활용하는 경우 **@Autowired** 라는 bean scanner를 통해 편하게 가져올 수 있다. (이때 반드시 component-scan을 설정해야한다!)
- singleton, prototype(singleton이 적용되지 않는) 등을 설정할 수 있다.

### XML 버전: applicationContext.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

// db와 연결
	<bean id="ds" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
		<property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
		<property name="url" value="jdbc:mysql://127.0.0.1:3306/ssafyweb?serverTimezone=UTC&amp;useUniCode=yes&amp;characterEncoding=UTF-8"/>
		<property name="username" value="ssafy"/>
		<property name="password" value="ssafy"/>
	</bean>

// instance 생성

    // DAO는 ds 가 필요하고
	<bean id="gbDao" class="com.ssafy.model.dao.GuestBookDaoImpl">
		<property name="dataSource" ref="ds"/>  // 1. 프로퍼티로 주입하는 방법
        <constructor-arg reg="ds" />            // 2. 생성자로 주입하는 방법 (택 1)            
	</bean>
	<bean id="lDao" class="com.ssafy.model.dao.LoginDaoImpl">
		<property name="dataSource" ref="ds"/>
	</bean>
	
    // Service는 DAO가 필요하다 (ref 확인!)
	<bean id="gbService" class="com.ssafy.model.service.GuestBookServiceImpl">
		<property name="guestBookDao" ref="gbDao"/>
	</bean>
	<bean id="lService" class="com.ssafy.model.service.LoginServiceImpl">
		<property name="loginDao" ref="lDao"/>
	</bean>

</beans>
```

DataSource를 받아와서 사용


### Annotation 버전 : ApplicationConfig.java
```java
package com.ssafy.configuration;

import javax.sql.DataSource;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;

@Configuration
@ComponentScan(basePackages = {"com.ssafy"})
public class ApplicationConfig {
	
	@Bean
	public DataSource dataSource() {
		SimpleDriverDataSource ds = new SimpleDriverDataSource();
		ds.setDriverClass(com.mysql.cj.jdbc.Driver.class);
		ds.setUrl("jdbc:mysql://127.0.0.1:3306/ssafyweb?serverTimezone=UTC&useUniCode=yes&characterEncoding=UTF-8");
		ds.setUsername("ssafy");
		ds.setPassword("ssafy");
		return ds;
	}

}
```

bean 등록 필요 없이 바로
```java
@Autowired
private DataSource dataSource;
```
를 통해 주입받아 사용

@Autowired는 DataSource 타입과 일치하는 것을 configuration에서 자동으로 가져와서 연결해준다.    
동일한 타입의 bean이 여러개일 경우 @Qualifier("이름") 으로 식별

### Annotation : Spring bean 설정

- @Controller
- @Service
- @Repository : DAO
- @Component : 그 외 layer 구분이 어려운 것들 ex) DTO
