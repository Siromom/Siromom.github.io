---
layout: post
title: 메모리 관리
date: 2019-09-14 23:09:00
author: "SeWonKim"
categories: [OS]
tags: [jekyll, OS]
fullview: false
comments: true
description: 메모리 관리
---

# 메모리 관리

## key point

### 메모리의 역할

메모리에는 쓰기가 가능한 RAM, 읽기만 가능한 ROM이 있다.
일반적으로 말하는 메모리는 RAM으로 메인 메모리(주기억 장치)라고 한다.

RAM은 전원을 끄면 내용이 날아가는 휘발성 메모리이고, ROM은 비휘발성 메모리이다.
SD카드나 USB는 메모리 쓰기가 가능하지만 비휘발성 메모리이기 때문에 ROM으로 분류한다.

메모리는 실행하는 프로그램이 로드되는 장소이며, 프로그램 작업 장소로도 사용된다.
읽고 쓰는 속도가 보조 기억 장치보다 빠르기 때문에 일단 메모리로 읽어들이는 것이 효율적이다.
하드디스크에 대한 액세스를 줄이기 위해서 자주 참조하는 프로그램이나 데이터는 캐시 메모리에 저장해 퍼포먼스를 향상시킨다.

### 메모리의 주소

메모리에는 address가 붙어있는데 주소를 지정하면 해당 주소에 저장되어 있는 데이터를 변경하거나 명령을 호출 할 수 있다.

---

## 🖥️메모리의 종류

### 특성에 따른 종류

- RAM: 읽기 / 쓰기 / 휘발성
- ROM: 읽기 / 비휘발성

### RAM

RAM은 주로 프로그램의 작업 영역으로 사용된다.

- DRAM(Dynamic RAM): 대용량 / 느린 처리 속도 / 소비전력 작음 / refresh 동작 필요 / 메인메모리나 VRAM으로 사용
- SRAM(Static RAM): 저용량 / 빠른 처리 속도 / 소비전력 큼 / FlipFlop 회로 / 캐시 메모리로 사용

리프레시 동작은 정보를 보존, 유지하기 위해 기억 내용을 다시 쓰는 것이고,
FlipFlop 회로는 리프레시 동작이 불필요한 회로이다.

### ROM

ROM은 컴퓨터 기동 시 시스템 체크나 BIOS 정보 등을 저장하는 데 사용된다.

- 마스크 ROM: ROM의 제조공정에서 마이크로 프로그램 등을 기록. 내용 변경 불가.
- PROM(Programmable ROM): 다시 쓰기가 가능한 ROM이지만 횟수 제한이 있다.

PROM은 EPROM(Erasable PROM), EEPROM(Electrically Erasable PROM), 플래시 메모리로 나눌 수 있다.  
BIOS를 저장하는데에는 EEPROM을 사용한다.  
USB나 SD카드, SSD드라이브에는 플래시 메모리가 사용된다. (일괄 또는 부분적 삭제, 다시 쓰기가 가능)

## 🖥️메모리 공간

메모리 공간은 주소를 붙여서 영역을 식별한다.

32bit CPU = 최대 메모리 용량 4GB(2^32byte)  
64bit CPU = 최대 메모리 용량 16EB(2^64byte)

EB: 엑사 바이트

```
1KB = 1024byte
1MB = 1024KB
1GB = 1024MB
1TB = 1024GB

KB < MB < GB < TB < PB < EB < ZB < YB
```

메모리는 목적에 따라 사용되는 영역이 다르다.

### 메인 메모리의 용도

CPU가 계산할 때 데이터를 기억해 두기 위해 메인메모리를 사용한다.

- 힙: 파일로부터 읽어들인 데이터나 네트워크상에서 수신한 데이터를 저장할 때 필요한 만큼만 확보해 사용하는 메모리 영역. 필요가 없어지면 해제한다.
- 스택: 프로그램 실행 중에 이용하는 변수의 내용을 일시적으로 저장하는 메모리 영역. 프로그램의 한 단위가 시작될 때 자동적으로 확보되고 처리가 종료되면 해제된다.

사용 할 수 있는 스택 영역의 용량이 정해져있기 때문에 너무 많이 사용하면 overflow가 발생한다.

## 🖥️가상 기억

메인 메모리보다 큰 기억 영역을 제공하는 장치

### 물리 메모리

컴퓨터에 실제로 장착되어있는 메모리를 말한다.

### 가상 메모리

최근의 OS는 하드디스크에 페이징 파일(스왑 파일)을 작성한다.  
이 페이징 파일과 물리 메모리를 합쳐서 가상 메모리 역역으로 간주함으로써 물리 메모리 용량을 초과한 메모리를 다룰 수 있다.

### 스왑(Swap)

메모리 용량이 부족할 때 메모리와 페이징 파일 사이에서 메모리 상 프로세스를 일시적으로 교환하는 것을 말한다.  
우선 순위가 낮은 프로세스를 페이지 파일로 저장해서 점유하고 있던 메인 메모리를 해제하고 하드디스크로 대피 시킨다.(스왑 아웃)  
스왑은 하드디스크에 자주 액세스하기 때문에 성능 저하로 이어진다.

## 🖥️메모리 확보와 해제

메모리 영역을 확보하는 것을 얼로케이션(Allocation)이라고 한다. 확보한 영역은 처리 종료 시 해제할 필요가 있다.

### 리로케이션(Relocation)

한 번 확보한 메모리 영역의 위치를 변경하는 것을 리로케이션이라고 한다.  
특히 실행 중인 프로그램의 위치를 변경하는 것을 다이나믹 리로케이션(Dynamic Relocation)이라고 한다.

### 가비지 콜렉션(Garbage Collection)

힙 영역이 가득 차서 액세스 할 수 없을 때, 불필요한 메모리 영역을 자동으로 해제하는 것이 가비지 콜렉션이다.
사용이 끝난 메모리 영역을 재이용하는 것을 말한다.

### 컴팩션(Compaction) a.k.a 조각모음

단편화된 메모리의 미사용 영역을 모아서 연속으로 이용할 수 있는 메모리 영역을 만드는 것을 컴팩션이라고 한다.

## 🖥️데이터 저장 순서

OS가 데이터를 읽어들일 때, 빈 용량이 없으면 기존의 데이터를 메모리로부터 꺼내야한다.  
이 때 데이터를 꺼내고 새 데이터를 저장하는 방법에는 LIFO와 FIFO가 있다.

### LIFO(Last In First Out)

가장 나중에 넣은 데이터를 가장 먼저 꺼내는 것. 스택 저장방법

### FIFO(First In First Out)

가장 먼저 넣은 데이터를 가장 먼저 꺼내는 것. Job 관리 저장방법

### 연결리스트(Linked List)

데이터 구성 = 요소 + 포인터(다음 데이터의 메모리 주소를 가리킴)

연결리스트를 이용하면 데이터가 순서대로 줄 설 필요가 없다.

## 🖥️매핑

OS가 물리 메모리와 가상 메모리 사이에서 프로그램이나 데이터를 대응시키는 것을 매핑(Mapping)이라고 한다.

### 페이징(Paging)

고정 길이 페이지 단위(4KB)로 매핑을 수행하는 것.  
페이징이 빈번히 일어나는 것을 스래싱(Thrashing)이라고 하는데 스래싱은 CPU 효율 저하의 원인이 된다.

_페이지 프레임: 메모리의 빈 영역_  
메인 메모리에 페이지 프레임이 없으면 페이지 폴트(Page Fault)라는 인터럽트가 발생한다.

### 세그먼테이션(Segmentation)

가변 길이 페이지 단위로 매핑을 수행하는 것.  
세그먼트에는 프로세스에 사용하는 메모리를 연속해서 할당한다.  
세그먼테이션을 빈번히 수행하면 프레그먼테이션(Fragmentation)이 발생해 컴팩션을 수행할 필요가 있다.

## 🖥️메모리 맵(I/O)

입출력 기기를 제어할 때 메인 메모리와 I/O 주소 공간을 공유하는 방식을 메모리 맵 I/O(Memory Mapped I/O)라고 한다.
I/O 주소공간도 메모리의 일부로 취급한다.

![image](https://user-images.githubusercontent.com/30452963/65041159-080bff00-d991-11e9-82a0-6f9baa8d2fa1.png)

### DMA(Direct Memory Access)

DMA는 CPU를 거치지 않고 I/O 디바이스와 메모리 사이에 직접 데이터를 주고 받는 방법이다.
메모리와 I/O 디바이스 사이에 놓인 DMA 컨트롤러를 통해 디바이스로부터 명령이나 데이터를 기록한다.
DMA 컨트롤러는 인터럽트 처리도 대행한다. CPU에 부담을 주지 않기 때문에 큰 데이터를 전송할 때 적합하다.

---

## 용어 정리

1. RAM(Random Access Memory)
2. ROM(Read Only Memory)
3. 보조 기억 장치
4. 캐시 메모리(Cache Memory)
5. 가상 메모리(Virtual Memory)
